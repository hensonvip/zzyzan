<?php
function icon_option_list($id){
	$icons = [
		'500px','adjust','adn','align-center','align-justify','align-left','align-right','amazon','ambulance','anchor','android','angellist','angle-double-down','angle-double-left','angle-double-right','angle-double-up','angle-down','angle-left','angle-right','angle-up','apple','archive','area-chart','arrow-circle-down','arrow-circle-left','arrow-circle-o-down','arrow-circle-o-left','arrow-circle-o-right','arrow-circle-o-up','arrow-circle-right','arrow-circle-up','arrow-down','arrow-left','arrow-right','arrow-up','arrows','arrows-alt','arrows-h','arrows-v','asterisk','at','automobile','backward','balance-scale','ban','bank','bar-chart','bar-chart-o','barcode','bars','battery-0','battery-1','battery-2','battery-3','battery-4','battery-empty','battery-full','battery-half','battery-quarter','battery-three-quarters','bed','beer','behance','behance-square','bell','bell-o','bell-slash','bell-slash-o','bicycle','binoculars','birthday-cake','bitbucket','bitbucket-square','bitcoin','black-tie','bold','bolt','bomb','book','bookmark','bookmark-o','briefcase','btc','bug','building','building-o','bullhorn','bullseye','bus','buysellads','cab','calculator','calendar','calendar-check-o','calendar-minus-o','calendar-o','calendar-plus-o','calendar-times-o','camera','camera-retro','car','caret-down','caret-left','caret-right','caret-square-o-down','caret-square-o-left','caret-square-o-right','caret-square-o-up','caret-up','cart-arrow-down','cart-plus','cc','cc-amex','cc-diners-club','cc-discover','cc-jcb','cc-mastercard','cc-paypal','cc-stripe','cc-visa','certificate','chain','chain-broken','check','check-circle','check-circle-o','check-square','check-square-o','chevron-circle-down','chevron-circle-left','chevron-circle-right','chevron-circle-up','chevron-down','chevron-left','chevron-right','chevron-up','child','chrome','circle','circle-o','circle-o-notch','circle-thin','clipboard','clock-o','clone','close','cloud','cloud-download','cloud-upload','cny','code','code-fork','codepen','coffee','cog','cogs','columns','comment','comment-o','commenting','commenting-o','comments','comments-o','compass','compress','connectdevelop','contao','copy','copyright','creative-commons','credit-card','crop','crosshairs','css3','cube','cubes','cut','cutlery','dashboard','dashcube','database','dedent','delicious','desktop','deviantart','diamond','digg','dollar','dot-circle-o','download','dribbble','dropbox','drupal','edit','eject','ellipsis-h','ellipsis-v','empire','envelope','envelope-o','envelope-square','eraser','eur','euro','exchange','exclamation','exclamation-circle','exclamation-triangle','expand','expeditedssl','external-link','external-link-square','eye','eye-slash','eyedropper','facebook','facebook-f','facebook-official','facebook-square','fast-backward','fast-forward','fax','feed','female','fighter-jet','file','file-archive-o','file-audio-o','file-code-o','file-excel-o','file-image-o','file-movie-o','file-o','file-pdf-o','file-photo-o','file-picture-o','file-powerpoint-o','file-sound-o','file-text','file-text-o','file-video-o','file-word-o','file-zip-o','files-o','film','filter','fire','fire-extinguisher','firefox','flag','flag-checkered','flag-o','flash','flask','flickr','floppy-o','folder','folder-o','folder-open','folder-open-o','font','fonticons','forumbee','forward','foursquare','frown-o','futbol-o','gamepad','gavel','gbp','ge','gear','gears','genderless','get-pocket','gg','gg-circle','gift','git','git-square','github','github-alt','github-square','gittip','glass','globe','google','google-plus','google-plus-square','google-wallet','graduation-cap','gratipay','group','h-square','hacker-news','hand-grab-o','hand-lizard-o','hand-o-down','hand-o-left','hand-o-right','hand-o-up','hand-paper-o','hand-peace-o','hand-pointer-o','hand-rock-o','hand-scissors-o','hand-spock-o','hand-stop-o','hdd-o','header','headphones','heart','heart-o','heartbeat','history','home','hospital-o','hotel','hourglass','hourglass-1','hourglass-2','hourglass-3','hourglass-end','hourglass-half','hourglass-o','hourglass-start','houzz','html5','i-cursor','ils','image','inbox','indent','industry','info','info-circle','inr','instagram','institution','internet-explorer','intersex','ioxhost','italic','joomla','jpy','jsfiddle','key','keyboard-o','krw','language','laptop','lastfm','lastfm-square','leaf','leanpub','legal','lemon-o','level-down','level-up','life-bouy','life-buoy','life-ring','life-saver','lightbulb-o','line-chart','link','linkedin','linkedin-square','linux','list','list-alt','list-ol','list-ul','location-arrow','lock','long-arrow-down','long-arrow-left','long-arrow-right','long-arrow-up','magic','magnet','mail-forward','mail-reply','mail-reply-all','male','map','map-marker','map-o','map-pin','map-signs','mars','mars-double','mars-stroke','mars-stroke-h','mars-stroke-v','maxcdn','meanpath','medium','medkit','meh-o','mercury','microphone','microphone-slash','minus','minus-circle','minus-square','minus-square-o','mobile','mobile-phone','money','moon-o','mortar-board','motorcycle','mouse-pointer','music','navicon','neuter','newspaper-o','object-group','object-ungroup','odnoklassniki','odnoklassniki-square','opencart','openid','opera','optin-monster','outdent','pagelines','paint-brush','paper-plane','paper-plane-o','paperclip','paragraph','paste','pause','paw','paypal','pencil','pencil-square','pencil-square-o','phone','phone-square','photo','picture-o','pie-chart','pied-piper','pied-piper-alt','pinterest','pinterest-p','pinterest-square','plane','play','play-circle','play-circle-o','plug','plus','plus-circle','plus-square','plus-square-o','power-off','print','puzzle-piece','qq','qrcode','question','question-circle','quote-left','quote-right','ra','random','rebel','recycle','reddit','reddit-square','refresh','registered','remove','renren','reorder','repeat','reply','reply-all','retweet','rmb','road','rocket','rotate-left','rotate-right','rouble','rss','rss-square','rub','ruble','rupee','safari','save','scissors','search','search-minus','search-plus','sellsy','send','send-o','server','share','share-alt','share-alt-square','share-square','share-square-o','shekel','sheqel','shield','ship','shirtsinbulk','shopping-cart','sign-in','sign-out','signal','simplybuilt','sitemap','skyatlas','skype','slack','sliders','slideshare','smile-o','soccer-ball-o','sort','sort-alpha-asc','sort-alpha-desc','sort-amount-asc','sort-amount-desc','sort-asc','sort-desc','sort-down','sort-numeric-asc','sort-numeric-desc','sort-up','soundcloud','space-shuttle','spinner','spoon','spotify','square','square-o','stack-exchange','stack-overflow','star','star-half','star-half-empty','star-half-full','star-half-o','star-o','steam','steam-square','step-backward','step-forward','stethoscope','sticky-note','sticky-note-o','stop','street-view','strikethrough','stumbleupon','stumbleupon-circle','subscript','subway','suitcase','sun-o','superscript','support','table','tablet','tachometer','tag','tags','tasks','taxi','television','tencent-weibo','terminal','text-height','text-width','th','th-large','th-list','thumb-tack','thumbs-down','thumbs-o-down','thumbs-o-up','thumbs-up','ticket','times','times-circle','times-circle-o','tint','toggle-down','toggle-left','toggle-off','toggle-on','toggle-right','toggle-up','trademark','train','transgender','transgender-alt','trash','trash-o','tree','trello','tripadvisor','trophy','truck','try','tty','tumblr','tumblr-square','turkish-lira','tv','twitch','twitter','twitter-square','umbrella','underline','undo','university','unlink','unlock','unlock-alt','unsorted','upload','usd','user','user-md','user-plus','user-secret','user-times','users','venus','venus-double','venus-mars','viacoin','video-camera','vimeo','vimeo-square','vine','vk','volume-down','volume-off','volume-up','warning','wechat','weibo','weixin','whatsapp','wheelchair','wifi','wikipedia-w','windows','won','wordpress','wrench','xing','xing-square','y-combinator','y-combinator-square','yahoo','yc','yc-square','yelp','yen','youtube','youtube-play','youtube-square'
		];
	?>
	<datalist id="<?= $id;?>">
		<?php 
		foreach($icons as $v){ 
			?><option value="<?= $v;?>"></option><?php
		}
		?>
	</datalist>
	<?php
}
function filter_blank($s){
	return preg_replace('/[\s\x{3000}\x{FEFF}\xA0]+/ui','',$s);
}
/**
 * Filter the js
 *
 * @param string $value HTML code
 * @return string
 * @version 1.0.0
 */
function fliter_script($value) {
	$value = preg_replace("/(javascript:)?on(click|load|key|mouse|error|abort|move|unload|change|dblclick|move|reset|resize|submit)/i","data-filter",$value);
	$value = preg_replace("/(.*?)<\/script>/si","",$value);
	$value = preg_replace("/(.*?)<\/iframe>/si","",$value);
	return $value;
}
/**
 * Output select tag html
 *
 * @param string $value Option value
 * @param string $text Option text
 * @param string $current_value Current option value
 * @version 1.0.1
 */
function the_option_list($value,$text,$current_value){
	$selected = $value == $current_value ? ' selected ' : null;
	?>
	<option value="<?= $value;?>" <?= $selected;?>><?= $text;?></option>
	<?php
}
/**
 * mult_search_array
 *
 * @param array
 * @param string
 * @param string
 * @return array
 * @version 1.0.0
 */
function mult_search_array($key,$value,$array){ 
	$results = []; 
	if (is_array($array)){ 
		if (isset($array[$key]) && $array[$key] == $value) 
		$results[] = $array; 
		foreach ($array as $subarray){ 
			$results = array_merge($results, mult_search_array($key, $value,$subarray)); 
		}
	} 
	return $results; 
} 
/**
 * array_multiwalk
 *
 * @param array
 * @param string function name
 * @return array
 * @version 1.0.1
 */
function array_multiwalk($a,$fn){
	if(!$a || !$fn) return false;
	foreach($a as $k => $v){
		if(is_array($v)){
			$a[$k] = array_multiwalk($v,$fn);
			continue;
		}else{
			$a[$k] = $fn($v);
		}
	}
	return $a;
}
/**
 * is_null_array
 *
 * @param array
 * @return bool
 * @version 1.0.0
 */
function is_null_array($arr = null){
	if(is_array($arr)){  
	   foreach($arr as $k=>$v){  
			if($v && !is_array($v)){  
				return false;  
			}
			$t = is_null_array($v);  
			if(!$t){  
				return false;  
			}  
		}
		return true;  
	}else{
		return !$arr ? true : false;
	}
}
/**
 * chmodr
 * 
 * @param string $path path or filepath
 * @param int $filemode
 * @return bool
 * @version 1.0.0
 */
function chmodr($path = null, $filemode = 0777) { 
	if(!is_dir($path)) return chmod($path,$filemode); 
	$dh = opendir($path); 
	while(($file = readdir($dh)) !== false){
		if($file != '.' && $file != '..'){
			$fullpath = $path.'/'.$file;
			if(is_link($fullpath)){
				return false;
			}else if(!is_dir($fullpath)&& !chmod($fullpath, $filemode)){
				return false;
			}else if(!chmodr($fullpath,$filemode)){
				return false;
			}
		}
	}
	closedir($dh);
	if(chmod($path,$filemode)){
		return true; 
	}else{
		return false;
	}
}

 /**
  * remove_dir
  * 
  * 
  * @param string $path
  * @return 
  * @version 1.0.3
  * 
  */
function remove_dir($path){
	if(!file_exists($path)) 
		return false;
		
	if(is_file($path)){
		unlink($path);
		return;
	}
		
	if($handle = opendir($path)){
		while(false !== ($item = readdir($handle))){
			if($item == '.' || $item == '..')
				continue;
			if(is_dir($path . '/' . $item)){
				remove_dir($path . '/' . $item);
			}else{
				unlink($path . '/' . $item);
			}
		}
		closedir($handle);
		rmdir($path);
	}
}
/**
 * Retrieve the translation of $text and escapes it for safe use in an attribute.
 *
 * If there is no translation, or the text domain isn't loaded, the original text is returned.
 *
 * @since 2.8.0
 *
 * @param string $text   Text to translate.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated strings.
 * @return string Translated text on success, original text on failure.
 */
function esc_attr___( $text, $domain = null ) {
	if(!$domain)
		$domain = theme_functions::$iden;
	return esc_attr( translate( $text, $domain ) );
}
/**
 * Display translated text that has been escaped for safe use in an attribute.
 *
 * @since 2.8.0
 *
 * @param string $text   Text to translate.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated strings.
 */
function esc_attr__e( $text, $domain = null ) {
	if(!$domain)
		$domain = theme_functions::$iden;
	echo esc_attr( translate( $text, $domain ) );
}
/**
 * Display translated text that has been escaped for safe use in HTML output.
 *
 * @since 2.8.0
 *
 * @param string $text   Text to translate.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated strings.
 */
function esc_html__e( $text, $domain = null ) {
	if(!$domain)
		$domain = theme_functions::$iden;
	echo esc_html( translate( $text, $domain ) );
}
/**
 * Translate string with gettext context, and escapes it for safe use in an attribute.
 *
 * @since 2.8.0
 *
 * @param string $text    Text to translate.
 * @param string $context Context information for the translators.
 * @param string $domain  Optional. Text domain. Unique identifier for retrieving translated strings.
 * @return string Translated text
 */
function esc_attr__x( $text, $context, $domain = null ) {
	if(!$domain)
		$domain = theme_functions::$iden;
	return esc_attr( translate_with_gettext_context( $text, $context, $domain ) );
}
/**
 * Translate string with gettext context, and escapes it for safe use in HTML output.
 *
 * @since 2.9.0
 *
 * @param string $text    Text to translate.
 * @param string $context Context information for the translators.
 * @param string $domain  Optional. Text domain. Unique identifier for retrieving translated strings.
 * @return string Translated text.
 */
function esc_html__x( $text, $context, $domain = null ) {
	if(!$domain)
		$domain = theme_functions::$iden;
	return esc_html( translate_with_gettext_context( $text, $context, $domain ) );
}
/**
 * Retrieve the plural or single form based on the supplied amount.
 *
 * If the text domain is not set in the $l10n list, then a comparison will be made
 * and either $plural or $single parameters returned.
 *
 * If the text domain does exist, then the parameters $single, $plural, and $number
 * will first be passed to the text domain's ngettext method. Then it will be passed
 * to the 'ngettext' filter hook along with the same parameters. The expected
 * type will be a string.
 *
 * @param string $single The text that will be used if $number is 1.
 * @param string $plural The text that will be used if $number is not 1.
 * @param int    $number The number to compare against to use either $single or $plural.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated strings.
 * @return string Either $single or $plural translated text.
 */
function __n($single,$plural,$number,$domain = null){
	if(!$domain)
		$domain = theme_functions::$iden;
	return _n($single,$plural,$number,$domain);
}
/**
 * __x
 *
 * @param string $text Text to translate.
 * @param string $context Context information for the translators.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated 
 * @return string Translated context string without pipe.
 * @version 1.0.1
 */
function __ex($text,$context,$domain = null){
	if(!$domain)
		$domain = theme_functions::$iden;
	echo translate_with_gettext_context( $text, $context, $domain );
}
/**
 * __x
 *
 * @param string $text Text to translate.
 * @param string $context Context information for the translators.
 * @param string $domain Optional. Text domain. Unique identifier for retrieving translated 
 * @return string Translated context string without pipe.
 * @version 1.0.1
 */
function __x($text,$context,$domain = null){
	if(!$domain)
		$domain = theme_functions::$iden;
	return translate_with_gettext_context( $text, $context, $domain );
}
/**
 * __e()
 * translate function
 * 
 * @param string $text your translate text
 * @param string $domain your translate tdomain
 * @return string display
 * @version 1.1.0
 * 
 */
function __e($text,$domain = null){
	if(!$domain)
		$domain = theme_functions::$iden;
	echo translate( $text, $domain );
}
/**
 * ___()
 * translate function
 * 
 * @param string $text your translate text
 * @param string $domain your translate domain
 * @version 1.1.0
 * 
 */
function ___($text,$domain = null){
	if(!$domain)
		$domain = theme_functions::$iden;
	return translate( $text, $domain );
}
/**
 * status_tip
 *
 * @param mixed
 * @return string
 * @example status_tip('error','content');
 * @example status_tip('error','big','content');
 * @example status_tip('error','big','content','span');
 * @version 2.0.3
 */
function status_tip(){
	$args = func_get_args();
		
	$defaults = array('type','size','content','wrapper');
	$types = array('loading','success','error','question','info','ban','warning');
	$sizes = array('small','middle','large');
	$wrappers = array('div','span');
	$type = null;
	$size = null;
	$wrapper = null;

	switch(count($args)){
		case 1:
			$content = $args[0];
			break;
		case 2:
			$type = $args[0];
			$content = $args[1];
			break;
		default:
			foreach($args as $k => $v){
				$$defaults[$k] = $v;
			}
	}
	if(!$type)
		$type = $types[0];
	if(!$size)
		$size = $sizes[0];
	if(!$wrapper)
		$wrapper = $wrappers[0];

	switch($type){
		case 'success':
			$icon = 'check-circle';
			break;
		case 'error' :
			$icon = 'times-circle';
			break;
		case 'info':
		case 'warning':
			$icon = 'exclamation-circle';
			break;
		case 'question':
		case 'help':
			$icon = 'question-circle';
			break;
		case 'ban':
			$icon = 'minus-circle';
			break;
		case 'loading':
		case 'spinner':
			$icon = 'circle-o-notch fa-spin';
			break;
		default:
			$icon = $type;
	}
	
	return '<' . $wrapper . ' class="tip-status tip-status-' . $size . ' tip-status-' . $type . '"><i class="fa fa-' . $icon . ' fa-fw"></i> ' . $content . '</' . $wrapper . '>';
}

/**
 * Get remote server file size
 * 
 * 
 * @param string $url The remote file
 * @return int The file size, false if file is not exist
 * @version 1.0.0
 * 
 */
function get_remote_size($url = null){  
	if(!$url) return false;
	
    $uh = curl_init();  
    curl_setopt($uh, CURLOPT_URL, $url);  
  
    // set NO-BODY to not receive body part  
    curl_setopt($uh, CURLOPT_NOBODY, 1);  
  
    // set HEADER to be false, we don't need header  
    curl_setopt($uh, CURLOPT_HEADER, 0);  
  
    // retrieve last modification time  
    curl_setopt($uh, CURLOPT_FILETIME, 1);  
    curl_exec($uh);  
  
    // assign filesize into $filesize variable  
    $filesize = curl_getinfo($uh,CURLINFO_CONTENT_LENGTH_DOWNLOAD);  
  
    // assign file modification time into $filetime variable  
    $filetime = curl_getinfo($uh,CURLINFO_FILETIME);  
    curl_close($uh);  
  
    // push out  
    return array("size"=>$filesize,"time"=>$filetime);  
}
/**
 * multidimensional searching
 * 
 * 
 * @param array $parents The parents array
 * @param array $searched What want you search,
 * like this: array('date'=>1320883200, 'uid'=>5)
 * @return string If exists return the key name, or false
 * @version 1.0.0
 * @author revoke
 * 
 */
function multidimensional_search($parents, $searched) { 
	if(empty($searched) || empty($parents)) return false;

	foreach($parents as $key => $value){
		$exists = true; 
		foreach ($searched as $skey => $svalue) { 
			$exists = ($exists && IsSet($parents[$key][$skey]) && $parents[$key][$skey] == $svalue);
		} 
		if($exists){
			return $key;
		} 
	} 
	return false; 
} 

/**
 * html_minify
 * 
 * 
 * @param string The html code
 * @return string The clear html code
 * @version 1.0.2
 * @author higrid.net
 * 
 */
function html_minify($html){
	return preg_replace(
		[
			'/ {2,}/',
			'/<!--.*?-->|\t|(?:\r?\n[ \t]*)+/s'
		],
		[
			' ',
			''
		],
		$html
	);
}
/**
 * Refer to url address
 * 
 * 
 * @param string $url The want to go url
 * @param string/array $param The wnat to go url's param
 * @return bool false that not enough param, otherwise refer to the url
 * @version 1.0.2
 * @author INN STUDIO
 * 
 */
function refer_url($url,$param = null){
	if(is_array($param))
		$param = http_build_query($param);

	$parse_url = parse_url($url);
	if(isset($parse_url['query'])){
		$location = $param ? 'Location: ' . $url . '&' . $param : 'Location: ' . $url;
	}else{
		$location = $param ? 'Location: ' . $url . '?' . $param : 'Location: ' . $url;
	}
	die(header($location));
}
/**
 * encode
 * @param string $string 原文或者密文
 * @param string $operation 操作(encode | decode), 默认为 decode
 * @param string $key 密钥
 * @param int $expiry 密文有效期, 加密时候有效， 单位 秒，0 为永久有效
 * @return string 处理后的 原文或者 经过 base64_encode 处理后的密文
 * @example
 *   $a = authcode('abc', 'encode', 'key');
 *   $b = authcode($a, 'decode', 'key');  // $b(abc)
 *
 *   $a = authcode('abc', 'encode', 'key', 3600);
 *   $b = authcode('abc', 'decode', 'key'); // 在一个小时内，$b(abc)，否则 $b 为空
 */
function authcode($string, $operation = 'decode', $key = 'innstudio', $expiry = 0) {

    $ckey_length = 4;

    $key = md5($key);
    $keya = md5(substr($key, 0, 16));
    $keyb = md5(substr($key, 16, 16));
    $keyc = $ckey_length ? ($operation == 'decode' ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : null;

    $cryptkey = $keya.md5($keya.$keyc);
    $key_length = strlen($cryptkey);

    $string = $operation == 'decode' ? base64_decode(substr($string, $ckey_length)) : sprintf('%010d', $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;
    $string_length = strlen($string);

    $result = null;
    $box = range(0, 255);

    $rndkey = [];
    for($i = 0; $i <= 255; $i++) {
        $rndkey[$i] = ord($cryptkey[$i % $key_length]);
    }

    for($j = $i = 0; $i < 256; $i++) {
        $j = ($j + $box[$i] + $rndkey[$i]) % 256;
        $tmp = $box[$i];
        $box[$i] = $box[$j];
        $box[$j] = $tmp;
    }

    for($a = $j = $i = 0; $i < $string_length; $i++) {
        $a = ($a + 1) % 256;
        $j = ($j + $box[$a]) % 256;
        $tmp = $box[$a];
        $box[$a] = $box[$j];
        $box[$j] = $tmp;
        $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));
    }

    if($operation == 'decode') {
        if((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() > 0) && substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) {
            return substr($result, 26);
        } else {
            return false;
        }
    } else {
        return $keyc.str_replace('=', '', base64_encode($result));
    }
}
/**
 * Get client IP
 *
 * @return string
 * @version 2.0.0
 */
function get_client_ip(){
	return preg_replace( '/[^0-9a-fA-F:., ]/', '',$_SERVER['REMOTE_ADDR'] );
}

/**
 * Download file
 *
 * @param string $url Remote file url
 * @param string $dir Saven dir
 * @param string $name Saven filename
 * @param int $time_limit
 * @return bool
 * @version 1.0.1
 */
 function download_file($url,$dir,$name = null,$time_limit = 300){
	set_time_limit($time_limit);
	
	if(!$name){
		$default_name = explode('/',$url);
		$default_name = $default_name[count($default_name) - 1];
		$name = $default_name;
	}
 
    $fp = fopen($dir.'/'.$name, 'w');
 
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_FILE, $fp);
 
    $data = curl_exec($ch);
 
    curl_close($ch);
    fclose($fp);
	return true;
}

/**
 * get_img_source
 *
 * @param string
 * @return string
 * @version 1.1.0
 */
function get_img_source($str,$all = false){
	$pattern = '/<img[^>]+src\s*=\s*[\"\']\s*([^\"\']+)/i';
	preg_match_all($pattern, $str, $matches);
	if($all){
		return $matches[1];
	}else{
		return isset($matches[1][0]) ? $matches[1][0] : null;
	}
		
}
/**
 * friendly_date
 *
 * @param string $time Format timestamp
 * @return string
 * @version 1.0.2
 */
function friendly_date($timestamp){
	$text = null;
	
	/** time difference */
	static $current_time = null;
	if($current_time === null)
		$current_time = current_time( 'timestamp' );
		
	$t = $current_time - $timestamp;

	switch($t){
		/**
		 * in 1 minu, just now
		 */
		case ($t < 60) :
			$text = ___('Just');
			break;
		/** 
		 * in 1 hours, 60 * 60 = 3600
		 */
		case ($t < 3600) :
			$text = sprintf(___('%dmin ago'),floor($t / 60));
			break;
		/** 
		 * in 1 day, 60 * 60 * 24 = 86400
		 */
		case ($t < 86400) :
			$text = sprintf(___('%dh ago'),floor($t / 3600));
			break;
		/** 
		 * in 1 month, 60 * 60 * 24 * 30 = 2592000
		 */
		case ($t < 2592000) :
			$text = sprintf(___('%dd ago'),floor($t / 86400));
			break;
		/**
		 * in 1 year, 60 * 60 * 24 * 30 * 12 = 31104000
		 */
		case ($t < 31104000) :
			$text = sprintf(___('%dm ago'),floor($t / 2592000));
			break;
		/**
		 * dislay date
		 */
		default:
			$text = date(___('M j, Y'), $timestamp);
	}
	return $text;
}
/**
 * get_current_url
 *
 * @return string
 * @version 1.0.3
 */
function get_current_url(){
	static $cache = null;
	if($cache !== null)
		return $cache;
	$cache = '//' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
	return $cache;
}

/**
 * str_sub
 *
 * @param string
 * @param int
 * @param string
 * @return string
 * @version 1.0.0
 */
function str_sub($str, $len = 120, $extra = '&hellip;'){
	
	if(mb_strlen(trim($str)) <= $len)
		return $str;
		
	return mb_substr($str, 0, $len) . $extra;
}

/**
 * url_sub
 *
 * @param string $url URL address
 * @param int $before_len
 * @param int $after_len
 * @param int $extra_len
 * @param int $middle_str
 * @return string
 * @version 1.0.1
 */
function url_sub($url,$before_len = 30,$after_len = 20,$extra_len = 10,$middle_str = ' ... '){
	$url_len = mb_strlen($url);
	/* url 小于指定长度 */
	if($url_len <= ($before_len + $after_len + $extra_len)){
		return $url;
	}else{
		$url_before = mb_substr($url,0,$before_len);
		$url_after = mb_substr($url,-$after_len);
		return $url_before.$middle_str.$url_after;
	}
}
?>